(function(s,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(s=typeof globalThis!="undefined"?globalThis:s||self,t(s["form-validation"]={}))})(this,function(s){"use strict";var G=Object.defineProperty,H=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var w=(s,t,o)=>t in s?G(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,k=(s,t)=>{for(var o in t||(t={}))Q.call(t,o)&&w(s,o,t[o]);if(L)for(var o of L(t))R.call(t,o)&&w(s,o,t[o]);return s},x=(s,t)=>H(s,J(t));const t="form-validation",o="[data-validation]",O="[data-mask]";function T({main:f,elm:c,state:r,on:l,emit:v,dependencies:j,trigger:q}){var S;const{validations:p,masks:y}=j,m=(S=c.querySelector("input,select,textarea"))==null?void 0:S.form;let g=M(m);f(e=>{l("input","input, textarea, select",N),l("input",O,$),l("focus",o,K),l("input",o,b("input")),l("change",o,b("change")),l("blur",o,b("blur")),m.addEventListener("reset",P),m.addEventListener("submit",z),I()});const I=()=>{if(!p)throw new Error("<form-validation> - No validations provided in dependencies");const e=D();r.set(n=>n.form.fields=e)},D=()=>{const e={};return g.forEach(n=>e[n]=""),e},b=e=>n=>{requestAnimationFrame(()=>{const a=n.target,d=a.name,u=A(a,m),E=a.dataset.validation.split(/\s/),h=[],F=r.get();E.forEach(i=>{if(i in p){const{ok:B,message:C}=p[i](u,a,m);B||h.push(C)}}),h.length?e==="input"?(g.add(a.name),r.set(i=>{i.form.isValid=!1,F.form.errors[d]&&h[0]!=F.form.errors[d]&&(i.form.errors[d]=h[0])})):(e==="blur"||e==="change")&&(g.add(a.name),r.set(i=>{i.form.errors[d]=h[0],i.form.isValid=!1})):(g.delete(a.name),r.set(i=>{delete i.form.errors[d],g.size||(i.form.isValid=!0)}))})},N=e=>{const{name:n}=e.target,a=A(e.target,m);r.set(d=>d.form.fields[n]=a)},z=e=>{e.preventDefault(),q("blur",o),requestAnimationFrame(()=>{const a=r.get().form.errors;if(Object.keys(a).length)v(`${t}:error`,{errors:a});else{const u=_(e.target);v(`${t}:submit`,k({},u))}})},$=e=>{let n=e.target.value;const{mask:a}=e.target.dataset;a.split(/s/).forEach(u=>{if(u&&u in y){const E=y[u];n=E(n,e.target,e.target.form)}}),r.set(u=>u.form.fields[e.target.name]=n||"")},K=e=>{r.set(n=>n.form.touched[e.target.name]=!0)},P=()=>{g=M(m),r.set({form:x(k({},V.form),{fields:D()})})}}const V={form:{errors:{},fields:{},touched:{},isValid:!1}},_=f=>{const c=new FormData(f),r={};for(let[l,v]of c)r[l]=v;return{formData:c,data:r}},A=(f,c)=>{const{name:r,type:l}=f;return l=="checkbox"?f.checked?f.value:"":c[r].value},M=f=>{const c=new Set;return Array.from(f.elements).filter(r=>r.name).forEach(r=>c.add(r.name)),c};s.default=T,s.model=V,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
