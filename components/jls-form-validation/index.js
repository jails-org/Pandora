(function(r,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(r=typeof globalThis!="undefined"?globalThis:r||self,t(r["jls-form-validation"]={}))})(this,function(r){"use strict";var C=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var L=(r,t,s)=>t in r?C(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,k=(r,t)=>{for(var s in t||(t={}))J.call(t,s)&&L(r,s,t[s]);if(j)for(var s of j(t))Q.call(t,s)&&L(r,s,t[s]);return r},w=(r,t)=>G(r,H(t));const t="jls-form-validation",s="[data-validation]",O="[data-mask]";function T({main:c,elm:l,state:o,on:i,emit:v,dependencies:x,trigger:F}){const{validations:p,masks:S}=x,g=l.querySelector("input").form;let m=M(l);c(e=>{i("input","input, textarea, select",N),i("input",O,z),i("focus",s,$),i("input",s,b("input")),i("change",s,b("change")),i("blur",s,b("blur")),g.addEventListener("reset",K),g.addEventListener("submit",q),I()});const I=()=>{if(!p)throw new Error("<form-validation> - No validations provided in dependencies");const e=A();o.set(n=>n.form.fields=e)},A=()=>{const e={};return m.forEach(n=>e[n]=""),e},b=e=>n=>{const a=n.target,d=a.name,u=y(a,g),E=a.dataset.validation.split(/\s/),h=[],D=o.get();E.forEach(f=>{if(f in p){const{ok:P,message:B}=p[f](u,a,g);P||h.push(B)}}),h.length?e==="input"?(m.add(a.name),o.set(f=>{f.form.isValid=!1,D.form.errors[d]&&h[0]!=D.form.errors[d]&&(f.form.errors[d]=h[0])})):(e==="blur"||e==="change")&&(m.add(a.name),o.set(f=>{f.form.errors[d]=h[0],f.form.isValid=!1})):(m.delete(a.name),o.set(f=>{delete f.form.errors[d],m.size||(f.form.isValid=!0)}))},N=e=>{const{name:n}=e.target,a=y(e.target,g);o.set(d=>d.form.fields[n]=a)},q=e=>{e.preventDefault(),F("blur",s);const a=o.get().form.errors;if(Object.keys(a).length)v(`${t}:error`,{errors:a});else{const u=_(e.target);v(`${t}:submit`,k({},u))}},z=e=>{let n=e.target.value;const{mask:a}=e.target.dataset;a.split(/s/).forEach(u=>{if(u&&u in S){const E=S[u];n=E(n,e.target,e.target.form)}}),o.set(u=>u.form.fields[e.target.name]=n||"")},$=e=>{o.set(n=>n.form.touched[e.target.name]=!0)},K=()=>{m=M(l),o.set({form:w(k({},V.form),{fields:A()})})}}const V={form:{errors:{},fields:{},touched:{},isValid:!1}},_=c=>{const l=new FormData(c),o={};for(let[i,v]of l)o[i]=v;return{formData:l,data:o}},y=(c,l)=>{const{name:o,type:i}=c;return i=="checkbox"?c.checked?c.value:"":l[o].value},M=c=>{const l=new Set,o=c.querySelectorAll(s);return Array.from(o).forEach(i=>l.add(i.name)),l};r.default=T,r.model=V,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
